#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Core constants and metadata for the debugger wrapper.

EVENT_NAMES: Mapping of Windows debug event codes to human-readable names.
VERSION / SCHEMA_VERSION: Used to tag JSONL output for forward compatibility.
EXCEPTION_CODES: Enhanced exception code mappings.
"""

VERSION = "1.7.0"
SCHEMA_VERSION = "wdb.v7"  # Enhanced error handling, validation, performance optimizations

EVENT_NAMES = {
    1: "EXCEPTION",
    2: "CREATE_THREAD", 
    3: "CREATE_PROCESS",
    4: "EXIT_THREAD",
    5: "EXIT_PROCESS",
    6: "LOAD_DLL",
    7: "UNLOAD_DLL", 
    8: "DEBUG_STRING",
    9: "RIP",
}

# Extended exception codes for better analysis
EXCEPTION_CODES = {
    0x80000001: "GUARD_PAGE_VIOLATION",
    0x80000002: "DATATYPE_MISALIGNMENT", 
    0x80000003: "BREAKPOINT",
    0x80000004: "SINGLE_STEP",
    0x80000026: "LONGJUMP",
    0x80000029: "UNWIND_CONSOLIDATE",
    0xC0000005: "ACCESS_VIOLATION",
    0xC0000006: "IN_PAGE_ERROR",
    0xC0000008: "INVALID_HANDLE",
    0xC000000D: "INVALID_PARAMETER",
    0xC0000017: "NO_MEMORY",
    0xC000001D: "ILLEGAL_INSTRUCTION",
    0xC0000025: "NONCONTINUABLE_EXCEPTION",
    0xC0000026: "INVALID_DISPOSITION",
    0xC000008C: "ARRAY_BOUNDS_EXCEEDED",
    0xC000008D: "FLOAT_DENORMAL_OPERAND",
    0xC000008E: "FLOAT_DIVIDE_BY_ZERO",
    0xC000008F: "FLOAT_INEXACT_RESULT",
    0xC0000090: "FLOAT_INVALID_OPERATION",
    0xC0000091: "FLOAT_OVERFLOW",
    0xC0000092: "FLOAT_STACK_CHECK",
    0xC0000093: "FLOAT_UNDERFLOW",
    0xC0000094: "INTEGER_DIVIDE_BY_ZERO",
    0xC0000095: "INTEGER_OVERFLOW",
    0xC0000096: "PRIVILEGED_INSTRUCTION",
    0xC00000FD: "STACK_OVERFLOW",
    0xC0000135: "DLL_NOT_FOUND",
    0xC0000138: "ORDINAL_NOT_FOUND",
    0xC0000139: "ENTRYPOINT_NOT_FOUND",
    0xC000013A: "CONTROL_C_EXIT",
    0xC0000409: "STACK_BUFFER_OVERRUN",
    0xC000041D: "FATAL_USER_CALLBACK_EXCEPTION",
    0xC0000420: "ASSERTION_FAILURE",
}

# Process access rights
PROCESS_ACCESS_RIGHTS = {
    0x0001: "TERMINATE",
    0x0002: "CREATE_THREAD", 
    0x0008: "VM_OPERATION",
    0x0010: "VM_READ",
    0x0020: "VM_WRITE",
    0x0040: "DUP_HANDLE",
    0x0080: "CREATE_PROCESS",
    0x0100: "SET_QUOTA",
    0x0200: "SET_INFORMATION",
    0x0400: "QUERY_INFORMATION",
    0x0800: "SUSPEND_RESUME",
    0x1000: "QUERY_LIMITED_INFORMATION",
    0x2000: "SET_LIMITED_INFORMATION",
}

# Performance limits
MAX_MEMORY_DUMP_SIZE = 16 * 1024 * 1024  # 16MB
MAX_CODE_WINDOW_SIZE = 8192  # 8KB
MAX_STACK_DUMP_SIZE = 65536  # 64KB
MAX_EVENT_COUNT = 1000000
MAX_TIMEOUT_MS = 300000  # 5 minutes
